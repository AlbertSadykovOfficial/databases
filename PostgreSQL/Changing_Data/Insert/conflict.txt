

			Методы реагирования при нарушении ограничений

					При вставке нвоых строк может возникнуть ситуация, когда нарушается ограничение
					первичного или уникального ключей, посколько вставляемые строки могут иметь  
					значения ключевых атрибутов, совпадающие с теми,что имеются в таблице.

					Для таких ситуаций пердусмотрено специальное средство - ON CONFLICT

					ON CONFLICT предусматривает 2 варианта дкйствий на выбор:

							1) Отменять добавление новой строки, не пораждая ошибки (DO NTHING)
							2) Замена операции добавления строки на операцию обновления (DO UPDATE)

									1. Отменять добавление новой строки, не пораждая ошибки

											(Пример: добавление строки, которая 100% будет конфликтовать)

											Можно указывать определенные столбцы, ошибки которых нужно
											игнорировать при вставке:
													ON CONFLICT ( aircraft_code ) DO NOTHING 
											Если их не указывать, будут игнорировтаь любые ошибки.
											Если указать один, то ТОЛЬКО ЕГО ошибки будут игнорироваться.

													WITH add_row AS
													(
															INSERT INTO aircrafts_tmp
																	VALUES ( 'SU9', 'Sukhoi SuperJet-100', 3000)
																	ON CONFLICT DO NOTHING
																	(или ON CONFLICT ( aircraft_code ) DO NOTHING )
															RETURNING *
													)
													INSERT INTO aircrafts_log
														SELECT add_row.aircraft_code, add_row.model, add_row.range, 
																	 current_timestamp, 'INSERT'
														FROM add_row; 

									2. Замена операции добавления строки на операцию обновления

											В случае конфликта будет оновлена та строка таблицы aircraft_tmp,
											с которой конфликтовала вновь добавляемая строка.
											В результате новая строка добавлена не будет, а будет обновлено 
											значение столбца model на (Sukhoi SuperJet-228)

											+ ON CONSTRAINT - вместо имени столбца первичного ключа 
																				указывает наименование ограничения первичного ключа

													INSERT INTO aircrafts_tmp
															VALUES ( 'SU9', 'Sukhoi SuperJet-228', 3000)
															ON CONFLICT ON CONSTRAINT aircrafts_tmp_pkey
															DO UPDATE SET model = excluded.model,
																						range = excluded.range
													RETURNING *