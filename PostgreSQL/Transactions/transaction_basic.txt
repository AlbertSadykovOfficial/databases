

		Транзакции

				Транзакция - набор операций над БД, которые вместе образуют логически целостную процедуру
										 и могут быть выполнены либо ВСЕ ВМЕСТЕ, либо НЕ БУДЕТ ВЫПОЛНЕНА НИ ОДНА.
										 Отсюда 2 исхода: Выполнена и Отменена.


				Свойства транзакций (ACID):

						Атомарность (atomacity) - либо транзакция выполнена полностью, 
																			либо не выполнена вообще
						Согласованнось (consistency) - Перевод БД из одного согласованного состояния в другое
																					 при выполнении успешной транзакции
						Изолированность (isolation) - Во время выполнения тразакции, други транзакции должны иметь
																					(по возможности) минимальное влияние на нее
						Долговечность (durability) - После фиксации тразакции данные должны быть надежно защищены


				Феномены при выполнении параллельных транзакций

						1. Потерянное обновление (lost update) - Когда разные тразакции изменяют одни и те же данные
																										 то после фиксации изменений может оказаться, что одна
																										 тразакция перезаписала данные, обновленные и 
																										 зафиксирвоаныне другой.
						2. "Грязное" чтение (dirty read) - Тразакция читает данные, иземененые параллельной транзакцией,
																							 которая еще не завершилась. Тогда, если эта параллельная 
																							 тразакция будет отменена, то окажется, что 1 транзакция
																							 прочитала данные, которых нет в системе.
						3. Неповторяющееся чтение (non-repeatable read) - При повторном чтении тех же самых данных в рамках
																			 одной тразакции оказывается, что другая тразакция успела изменить и 
																			 зафиксировать эти данные.
																			 Результат: тот же самый запрос выдаст другой результат.
 						4. Фантомное чтение (phantom read) - транзакция потворно выбирает множство строк в соответствии
 																								с одним и тем же критерием. В интревале между этими выборками
 																								дургая тразакция добавляет новые стркои 
 																								и успешно фиксирует изменения.
 																								В результате: 
 																								При повторной выборке может быть получено другое множество
 						5. Аномалии сериализации (serializatin anomaly) - Результат успешной фиксации группы транзакций, 
 																															выполняющихся параллельно, не совпадает с результатом
 																															ни одного из возможных вариантов упорядоченния 
 																															этих транзакций, если бы они выполнялись послеовательно.

 						Сериализация:

 								Из-за порядка слежования транзакций может изменяться итоговый результат.
 								К примеру: Если сначала ПОЛУЧИТЬ зарплату, потом начислить проценты на текущий счет в банке
 													 или сначала начислить проценты а текщий счет, а потом ПОЛУЧИТЬ зарплату
 													 В итоге: в первом случае итоговая умма буде больше, чем во 2м

 								Так:

 								Сериализация 2х тразакций при их параллельном выполнении означает, что полученный результат будет
 								чоответствовтьодному из 2х возмоных вариантов упорядочивания транзакций при их последователном
 								выполнении. При этом нельзя сказать точно какой вариант будет реализован точно.

 								В том случае, если СУБД не может обеспечить нормальную сериализацию группы, придется выполнять
 								запрос повторно.


 				Уровень изоляции тразакций

 						Для конкретизации степени независимости параллельных тразакций вводится понятие изоляции тразакций.
 						Каждый уровень характеризуется перечнем тех феноменов, котоыре на данном уровне не допускаются.

 						Уровни изоляции SQL:

 								1. Read Uncommitted. - ДОПУСКАЕТ чтение "грязных" данных.
 																			 В PostgreSQL он строже и равен 2 - Read Committed
 								2. Read Committed. - Не допускает чтение "грязных" (незафиксированных) данных.
 								3. Repeatable Read.- (Read Committed) + не допускает неповторяющееся чтение. 
 																			(В PostgreSQL не опускается и фантомное чтение)  
 								4. Seriaizable. - Не дпускает ни один из феноменов, в том числе и сериализации.

 						СУБД обычно сама выставляет уровни изоляции, но можно их устанавливать вручную.
 						Так же можно устанавливать блокировки и на уровне отдельных строк или всей таблицы.

 						Значение изоляции по умолчанию - самое низкое:  Read Committed.


 						Посмотреть уровень:

 								SHOW default_transaction_isolation;